import React, { useMemo, useState } from "react";
import {
  Home, FileText, ShoppingBag, Users, Shield, Menu, X, LogIn, LogOut,
  ArrowRight, Image as ImageIcon, Video, PlaySquare, Music2, Star, MessageSquare,
  Search, Plus, Upload, Trash2, Calendar
} from "lucide-react";

// ------------------ Demo Data ------------------
const CLIENTS = [
  {
    id: "c1",
    name: "RS Films Group",
    projects: 6,
    socials: { youtube: "https://www.youtube.com/@RSFilmsBhojpuri" },
    payments: [
      { id: "p1", type: "YouTube", month: "Jul 2025", amount: 42000, status: "Paid" },
      { id: "p2", type: "OTT", month: "Aug 2025", amount: 12000, status: "Pending" },
    ],
    files: {
      raw: ["rs_shoot_01.zip"], psd: ["rs_poster_v3.psd"], edited: ["rs_song_edit_v2.prproj"], final: ["rs_release_master.mp4"],
    },
    releases: [{ id: "r1", title: "Radha Pallu Se", date: "2025-08-12" }],
  },
  {
    id: "c2",
    name: "Siddhi Vinayak Films",
    projects: 4,
    socials: { youtube: "https://www.youtube.com/@SiddhiVinayakFilmsBhakti" },
    payments: [
      { id: "p3", type: "YouTube", month: "Aug 2025", amount: 26000, status: "Paid" },
    ],
    files: { raw: [], psd: ["svf_thumb.psd"], edited: [], final: ["svf_bhakti_01.mp4"] },
    releases: [{ id: "r2", title: "Shiv Stuti", date: "2025-08-05" }],
  },
];

const CLIENT_CHANNELS = [
  { name: "Gudiya Jhaki Official", url: "https://www.youtube.com/@gudiyajhakiofficial" },
  { name: "Shivam Chhaliya Official", url: "https://www.youtube.com/@shivamchhaliyaofficial" },
  { name: "RS Films Bhojpuri", url: "https://www.youtube.com/@RSFilmsBhojpuri" },
  { name: "Ishu Tilakdhari Kanpur", url: "https://www.youtube.com/c/IshuTilakdhariKanpur" },
  { name: "Siddhi Vinayak Films Bhakti", url: "https://www.youtube.com/@SiddhiVinayakFilmsBhakti" },
];

const RELEASES = [
  { id: "REL1", title: "Radha Pallu Se", artist: "RS Films", date: "2025-08-12", cover: "https://images.unsplash.com/photo-1511379938547-c1f69419868d?q=80&w=800&auto=format&fit=crop" },
  { id: "REL2", title: "Shiv Stuti", artist: "SVF Bhakti", date: "2025-08-05", cover: "https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?q=80&w=800&auto=format&fit=crop" },
  { id: "REL3", title: "DJ Nights", artist: "DJ Aarav", date: "2025-07-28", cover: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=800&auto=format&fit=crop" },
];

const ARTISTS = [
  { id: "a1", name: "Aarav DJ", tags: ["DJ", "EDM"], rating: 4.8, price: 22000 },
  { id: "a2", name: "Priya Sinha", tags: ["Singer", "Bollywood"], rating: 4.6, price: 28000 },
  { id: "a3", name: "MC Rohan", tags: ["Anchor"], rating: 4.7, price: 18000 },
];

const STORE_ITEMS = [
  { id: "s1", name: "YouTube Thumbnail Pack (20 PSD)", type: "PSD", price: 799, desc: "Bold Bhojpuri style thumbs" },
  { id: "s2", name: "Song Poster Template", type: "PSD", price: 499, desc: "Festival release artwork" },
  { id: "s3", name: "Reel Preset Bundle", type: "Preset", price: 299, desc: "LUTs + captions" },
];

// ------------------ UI Helpers ------------------
const Chip = ({ children }) => (
  <span className="px-2 py-1 rounded-full text-xs border">{children}</span>
);

const Section = ({ title, icon, children, right }) => (
  <section className="space-y-3">
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-2 text-lg font-semibold">
        {icon}
        <span>{title}</span>
      </div>
      {right}
    </div>
    {children}
  </section>
);

// ------------------ Pages ------------------
const HomePage = ({ go }) => (
  <div className="max-w-7xl mx-auto px-4 py-10 space-y-10">
    {/* Hero */}
    <div className="grid lg:grid-cols-2 gap-8 items-center">
      <div>
        <h1 className="text-3xl md:text-5xl font-extrabold tracking-tight leading-tight">
          One‑Step Solution for All Digital Work
        </h1>
        <p className="mt-4 text-neutral-600 dark:text-neutral-300">
          Posters, Thumbnails, Video Shoot, Editing, YouTube/OTT Management, <b>Song Distribution</b>, Artist Booking, Marketplace – sab kuch ek jagah.
        </p>
        <div className="mt-6 flex flex-wrap gap-3">
          <button onClick={() => go("/services")} className="px-4 py-2 rounded-xl border flex items-center gap-2">
            Explore Services <ArrowRight className="w-4 h-4" />
          </button>
          <button onClick={() => go("/distribution")} className="px-4 py-2 rounded-xl border">Distribute a Song</button>
          <button onClick={() => go("/market")} className="px-4 py-2 rounded-xl bg-black text-white dark:bg-white dark:text-black">Buy PSD/Editing</button>
        </div>
        <div className="mt-6 flex flex-wrap gap-2 text-sm">
          <Chip>Posters</Chip>
          <Chip>Thumbnails</Chip>
          <Chip>Video Shoot</Chip>
          <Chip>Editing</Chip>
          <Chip>YouTube / OTT</Chip>
          <Chip>Song Distribution</Chip>
          <Chip>Artist Booking</Chip>
        </div>
      </div>
      <div className="rounded-3xl border border-neutral-200 dark:border-neutral-800 p-6">
        <img className="rounded-2xl" src="https://images.unsplash.com/photo-1521737604893-d14cc237f11d?q=80&w=1400&auto=format&fit=crop" alt="dashboard" />
      </div>
    </div>

    {/* Quick Actions */}
    <Section title="Quick Actions" icon={<LightningIcon />}>
      <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {[
          { label: "Create Poster/Thumbnail", to: "/market" },
          { label: "Upload RAW Footage", to: "/dashboard" },
          { label: "Distribute Song", to: "/distribution" },
          { label: "Book an Artist", to: "/artists" },
          { label: "Buy PSD Pack", to: "/market" },
          { label: "Start Client Chat", to: "/dashboard" },
        ].map((qa) => (
          <button key={qa.label} onClick={() => go(qa.to)} className="p-4 rounded-2xl border hover:shadow text-left">
            <div className="font-medium">{qa.label}</div>
            <div className="text-xs opacity-70">One step, instant start</div>
          </button>
        ))}
      </div>
    </Section>

    {/* Services Overview */}
    <Section title="All Services" right={<button onClick={() => go("/services")} className="text-sm underline">View all</button>} icon={<FileText className="w-4 h-4" />}>
      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-5">
        {[
          { icon: <ImageIcon className="w-5 h-5" />, title: "Poster / Thumbnail Design", desc: "Custom PSD + multi‑ratio exports" },
          { icon: <Video className="w-5 h-5" />, title: "Video Shoot", desc: "Cinematography, Drone, Lights, Crew" },
          { icon: <PlaySquare className="w-5 h-5" />, title: "Video Editing", desc: "Color, Sound, VFX, Captions" },
          { icon: <Music2 className="w-5 h-5" />, title: "YouTube/OTT Management", desc: "Uploads, SEO, payments tracking" },
          { icon: <ShoppingBag className="w-5 h-5" />, title: "Marketplace (PSDs/Presets)", desc: "Instant digital downloads" },
          { icon: <Users className="w-5 h-5" />, title: "Artist Booking", desc: "Singer/DJ/Anchors for events" },
          { icon: <FileText className="w-5 h-5" />, title: "Song Distribution", desc: "All major platforms release" },
          { icon: <MessageSquare className="w-5 h-5" />, title: "Social Media", desc: "Calendar, cross‑posting, reports" },
        ].map((s) => (
          <div key={s.title} className="rounded-2xl border p-5 hover:shadow">
            <div className="flex items-center gap-2 font-semibold">{s.icon}{s.title}</div>
            <p className="text-sm mt-2 opacity-80">{s.desc}</p>
            <div className="mt-4 flex gap-2">
              <button className="px-3 py-2 text-sm rounded-xl border">Know More</button>
              <button onClick={()=> s.title==='Song Distribution'? go('/distribution') : go('/services')} className="px-3 py-2 text-sm rounded-xl bg-black text-white dark:bg-white dark:text-black">Book</button>
            </div>
          </div>
        ))}
      </div>
    </Section>

    {/* Client Channels */}
    <Section title="Clients – YouTube Channels" right={<span className="text-sm opacity-70">{CLIENT_CHANNELS.length} channels</span>} icon={<PlaySquare className="w-4 h-4" />}>
      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
        {CLIENT_CHANNELS.map((ch) => (
          <a key={ch.url} href={ch.url} target="_blank" rel="noreferrer" className="p-4 rounded-2xl border hover:shadow group">
            <div className="font-medium truncate" title={ch.name}>{ch.name}</div>
            <div className="text-xs opacity-70 truncate">{ch.url}</div>
            <div className="mt-2 text-sm underline opacity-80 group-hover:opacity-100">Open Channel</div>
          </a>
        ))}
      </div>
    </Section>

    {/* Marketplace Highlights */}
    <Section title="Featured – PSDs & Editing" right={<button onClick={() => go("/market")} className="text-sm underline">Visit Marketplace</button>} icon={<ShoppingBag className="w-4 h-4" />}>
      <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
        {STORE_ITEMS.map((it) => (
          <div key={it.id} className="rounded-2xl border p-5">
            <div className="flex items-center justify-between">
              <div className="font-semibold">{it.name}</div>
              <Chip>{it.type}</Chip>
            </div>
            <div className="text-sm opacity-80 mt-1">{it.desc}</div>
            <div className="mt-4 flex items-center justify-between">
              <div className="font-bold">₹{it.price}</div>
              <button onClick={() => go('/market')} className="px-3 py-2 text-sm rounded-xl bg-black text-white dark:bg-white dark:text-black flex items-center gap-2">
                <ShoppingBag className="w-4 h-4" /> Buy
              </button>
            </div>
          </div>
        ))}
      </div>
    </Section>

    {/* Latest Releases Slider */}
    <Section title="Latest Releases" right={<button onClick={() => go('/distribution')} className="text-sm underline">Distribute Now</button>} icon={<Music2 className="w-4 h-4" />}>
      <div className="flex gap-4 overflow-x-auto pb-2">
        {RELEASES.map((r)=> (
          <div key={r.id} className="min-w-[240px] max-w-[240px] rounded-2xl border overflow-hidden">
            <img src={r.cover} alt={r.title} className="h-36 w-full object-cover"/>
            <div className="p-3">
              <div className="font-medium truncate" title={r.title}>{r.title}</div>
              <div className="text-xs opacity-70">{r.artist} · {new Date(r.date).toDateString()}</div>
            </div>
          </div>
        ))}
      </div>
    </Section>

    {/* Quick Stats */}
    <div className="grid md:grid-cols-3 gap-5">
      <div className="p-5 rounded-2xl border">
        <div className="text-sm opacity-70">Active Clients</div>
        <div className="text-3xl font-bold mt-1">{CLIENTS.length}</div>
      </div>
      <div className="p-5 rounded-2xl border">
        <div className="text-sm opacity-70">Available PSD/Services</div>
        <div className="text-3xl font-bold mt-1">{STORE_ITEMS.length}</div>
      </div>
      <div className="p-5 rounded-2xl border">
        <div className="text-sm opacity-70">Artists</div>
        <div className="text-3xl font-bold mt-1">{ARTISTS.length}</div>
      </div>
    </div>
  </div>
);

const ServicesPage = ({ go }) => (
  <div className="max-w-7xl mx-auto px-4 py-10 space-y-6">
    <h2 className="text-2xl font-bold">Services</h2>
    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-5">
      {[
        { icon: <ImageIcon className="w-5 h-5" />, title: "Poster / Thumbnail Design", desc: "Custom PSD + export for all ratios." },
        { icon: <Video className="w-5 h-5" />, title: "Video Shoot", desc: "Cinematography, Drone, Lights, Crew." },
        { icon: <PlaySquare className="w-5 h-5" />, title: "Video Editing", desc: "Color, Sound, VFX, Captions." },
        { icon: <Music2 className="w-5 h-5" />, title: "YouTube/OTT Management", desc: "Uploads, SEO, payments tracking." },
        { icon: <FileText className="w-5 h-5" />, title: "Song Distribution", desc: "Release to Spotify/Apple/JioSaavn etc." },
        { icon: <Users className="w-5 h-5" />, title: "Artist Booking", desc: "Singer/DJ/Anchors for events." },
        { icon: <MessageSquare className="w-5 h-5" />, title: "Social Media", desc: "Content calendar & cross‑posting." },
      ].map((s) => (
        <div key={s.title} className="rounded-2xl border p-5 hover:shadow">
          <div className="flex items-center gap-2 font-semibold">{s.icon}{s.title}</div>
          <p className="text-sm mt-2 opacity-80">{s.desc}</p>
          <div className="mt-4 flex gap-2">
            <button className="px-3 py-2 text-sm rounded-xl border">Know More</button>
            <button onClick={()=> s.title==='Song Distribution'? go('/distribution') : go('/market')} className="px-3 py-2 text-sm rounded-xl bg-black text-white dark:bg-white dark:text-black">Start</button>
          </div>
        </div>
      ))}
    </div>
  </div>
);

const DistributionPage = () => {
  const [submitted, setSubmitted] = useState(false);
  return (
    <div className="max-w-3xl mx-auto px-4 py-10 space-y-6">
      <h2 className="text-2xl font-bold">Song Distribution</h2>
      {!submitted ? (
        <div className="rounded-2xl border p-6 space-y-4">
          <div className="grid md:grid-cols-2 gap-4">
            <FormField label="Track Title" placeholder="Song name" />
            <FormField label="Primary Artist" placeholder="Artist name" />
            <FormField label="Language" placeholder="Hindi / Bhojpuri" />
            <FormField label="Label / Publisher" placeholder="Your label" />
            <FormField label="ISRC" placeholder="Auto‑generate later" />
            <FormField label="UPC" placeholder="For albums/EPs" />
            <div>
              <label className="text-xs opacity-70">Release Date</label>
              <input type="date" className="w-full mt-1 px-3 py-2 rounded-xl border bg-transparent" />
            </div>
            <div>
              <label className="text-xs opacity-70">Explicit</label>
              <select className="w-full mt-1 px-3 py-2 rounded-xl border bg-transparent"><option>No</option><option>Yes</option></select>
            </div>
            <div className="md:col-span-2">
              <label className="text-xs opacity-70">Platforms</label>
              <div className="grid grid-cols-2 md:grid-cols-3 gap-2 mt-1 text-sm">
                {['Spotify','Apple Music','YouTube Music','JioSaavn','Wynk','Gaana','Amazon Music'].map(p => (
                  <label key={p} className="flex items-center gap-2 p-2 rounded-lg border"><input type="checkbox"/> {p}</label>
                ))}
              </div>
            </div>
            <div className="md:col-span-2 grid md:grid-cols-2 gap-4">
              <UploadField label="Cover Art (3000x3000)" />
              <UploadField label="Audio File (WAV/FLAC)" />
            </div>
            <div className="md:col-span-2">
              <label className="text-xs opacity-70">Rights Declaration</label>
              <textarea rows={3} className="w-full mt-1 px-3 py-2 rounded-xl border bg-transparent" placeholder="I own/hold rights to the content..."></textarea>
            </div>
          </div>
          <div className="flex justify-end gap-2">
            <button onClick={()=>setSubmitted(true)} className="px-4 py-2 rounded-xl bg-black text-white dark:bg-white dark:text-black">Submit</button>
          </div>
        </div>
      ) : (
        <div className="rounded-2xl border p-6">
          <div className="text-lg font-semibold mb-2">Submission Received</div>
          <div className="text-sm opacity-80">Thank you! Hum aapse assets verify karke release process start karenge. Aap dashboard me status track kar sakte hain.</div>
          <div className="mt-4">
            <button onClick={()=> (window.location.hash = '/dashboard')} className="px-4 py-2 rounded-xl border">Go to Dashboard</button>
          </div>
        </div>
      )}
    </div>
  );
};

const MarketplacePage = ({ onAdd }) => (
  <div className="max-w-7xl mx-auto px-4 py-10 space-y-6">
    <div className="flex items-center justify-between">
      <h2 className="text-2xl font-bold">Marketplace</h2>
      <div className="flex items-center gap-2 text-sm"><Search className="w-4 h-4" /><input placeholder="Search" className="bg-transparent outline-none"/></div>
    </div>
    <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
      {STORE_ITEMS.map((it) => (
        <div key={it.id} className="rounded-2xl border p-5">
          <div className="flex items-center justify-between">
            <div className="font-semibold">{it.name}</div>
            <Chip>{it.type}</Chip>
          </div>
          <div className="text-sm opacity-80 mt-1">{it.desc}</div>
          <div className="mt-4 flex items-center justify-between">
            <div className="font-bold">₹{it.price}</div>
            <button onClick={() => onAdd(it)} className="px-3 py-2 text-sm rounded-xl bg-black text-white dark:bg-white dark:text-black flex items-center gap-2"><Plus className="w-4 h-4"/> Add</button>
          </div>
        </div>
      ))}
    </div>
  </div>
);

const ArtistsPage = ({ onBook }) => (
  <div className="max-w-7xl mx-auto px-4 py-10 space-y-6">
    <h2 className="text-2xl font-bold">Artists</h2>
    <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
      {ARTISTS.map((a) => (
        <div key={a.id} className="rounded-2xl border p-5">
          <div className="flex items-center justify-between">
            <div>
              <div className="font-semibold">{a.name}</div>
              <div className="text-xs opacity-70">{a.tags.join(', ')}</div>
            </div>
            <div className="flex items-center gap-1 text-yellow-500"><Star className="w-4 h-4" /> {a.rating}</div>
          </div>
          <div className="mt-4 flex items-center justify-between">
            <div className="font-bold">₹{a.price} / event</div>
            <button onClick={() => onBook(a)} className="px-3 py-2 text-sm rounded-xl bg-black text-white dark:bg-white dark:text-black">Book</button>
          </div>
        </div>
      ))}
    </div>
  </div>
);

const ClientDashboard = ({ client = CLIENTS[0] }) => (
  <div className="max-w-7xl mx-auto px-4 py-10 space-y-8">
    <div className="flex items-center justify-between">
      <div>
        <div className="text-sm opacity-70">Welcome back</div>
        <h2 className="text-2xl font-bold">{client.name} – Client Dashboard</h2>
      </div>
      <button className="px-3 py-2 text-sm rounded-xl border flex items-center gap-2"><Upload className="w-4 h-4"/> Upload Files</button>
    </div>

    <div className="grid lg:grid-cols-3 gap-6">
      <Section title="Projects" icon={<FileText className="w-4 h-4" />}>
        <div className="text-3xl font-bold">{client.projects}</div>
        <div className="text-xs opacity-70">Active</div>
      </Section>

      <Section title="Payments" icon={<ShoppingBag className="w-4 h-4" />} right={<button className="text-xs underline">View all</button>}>
        <div className="space-y-2">
          {client.payments.map((p) => (
            <div key={p.id} className="flex items-center justify-between rounded-xl border p-3">
              <div className="text-sm">{p.type} – {p.month}</div>
              <div className="text-sm font-semibold">₹{p.amount} <span className="text-xs ml-1 opacity-70">{p.status}</span></div>
            </div>
          ))}
        </div>
      </Section>

      <Section title="Social / Channels" icon={<PlaySquare className="w-4 h-4" />}>
        <a href={client.socials.youtube} target="_blank" rel="noreferrer" className="text-sm underline">YouTube</a>
        <div className="mt-2 text-xs opacity-70">Managed Channels</div>
        <div className="mt-2 grid sm:grid-cols-2 gap-2">
          {CLIENT_CHANNELS.map((ch)=> (
            <a key={ch.url} href={ch.url} target="_blank" rel="noreferrer" className="text-xs p-2 border rounded-lg truncate hover:shadow" title={ch.name}>{ch.name}</a>
          ))}
        </div>
      </Section>
    </div>

    <Section title="Files" icon={<Upload className="w-4 h-4" />}>
      <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
        {[
          { k: "raw", label: "RAW", list: client.files.raw },
          { k: "psd", label: "PSD", list: client.files.psd },
          { k: "edited", label: "Edited", list: client.files.edited },
          { k: "final", label: "Final", list: client.files.final },
        ].map((b) => (
          <div key={b.k} className="rounded-2xl border p-4">
            <div className="font-medium mb-2">{b.label}</div>
            {b.list.length ? (
              <ul className="space-y-1">
                {b.list.map((f) => (
                  <li key={f} className="flex items-center justify-between">
                    <span className="truncate" title={f}>{f}</span>
                    <button className="text-xs underline">Download</button>
                  </li>
                ))}
              </ul>
            ) : (
              <div className="text-xs opacity-70">No files</div>
            )}
          </div>
        ))}
      </div>
    </Section>

    <Section title="Releases & Social" icon={<Calendar className="w-4 h-4" />}>
      <div className="grid md:grid-cols-2 gap-4">
        <div className="rounded-2xl border p-4">
          <div className="font-medium mb-2">Recent Releases</div>
          <ul className="text-sm space-y-1">
            {client.releases.map((r) => (
              <li key={r.id} className="flex items-center justify-between"><span>{r.title}</span><span className="text-xs opacity-70">{r.date}</span></li>
            ))}
          </ul>
        </div>
        <div className="rounded-2xl border p-4">
          <div className="font-medium mb-2">Social Posts</div>
          <div className="text-xs opacity-70">Scheduler coming soon</div>
        </div>
      </div>
    </Section>
  </div>
);

const AdminDashboard = () => (
  <div className="max-w-7xl mx-auto px-4 py-10 space-y-8">
    <h2 className="text-2xl font-bold mb-2">Admin – Control Center</h2>
    <div className="grid lg:grid-cols-3 gap-6">
      <Section title="Clients" icon={<Users className="w-4 h-4" />}>
        <ul className="text-sm space-y-2">
          {CLIENTS.map((c) => (
            <li key={c.id} className="flex items-center justify-between p-3 rounded-xl border">
              <span>{c.name}</span>
              <button className="text-xs underline">Open</button>
            </li>
          ))}
        </ul>
      </Section>
      <Section title="Orders & Files" icon={<ShoppingBag className="w-4 h-4" />}>
        <div className="text-xs opacity-70">Connect to DB + Storage (S3/Drive) next</div>
      </Section>
      <Section title="Reports" icon={<FileText className="w-4 h-4" />}>
        <div className="text-xs opacity-70">Revenue, channel analytics, payouts</div>
      </Section>
    </div>
  </div>
);

const LoginPage = ({ onLogin }) => (
  <div className="max-w-md mx-auto px-4 py-16">
    <div className="rounded-2xl border p-6 space-y-4">
      <h2 className="text-xl font-bold">Login</h2>
      <div className="grid grid-cols-2 gap-2">
        <button onClick={() => onLogin({ role: "client" })} className="px-3 py-2 rounded-xl border">Demo Client</button>
        <button onClick={() => onLogin({ role: "admin" })} className="px-3 py-2 rounded-xl border">Demo Admin</button>
      </div>
      <div className="text-xs opacity-70">Real auth (JWT) integrate next.</div>
    </div>
  </div>
);

// ------------------ Layout & Nav ------------------
const LightningIcon = () => (
  <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M11 21h-1l1-7H7l6-11h1l-1 7h4l-6 11z"></path></svg>
);

const FormField = ({ label, placeholder }) => (
  <div>
    <label className="text-xs opacity-70">{label}</label>
    <input className="w-full mt-1 px-3 py-2 rounded-xl border bg-transparent" placeholder={placeholder} />
  </div>
);

const UploadField = ({ label }) => (
  <div>
    <label className="text-xs opacity-70">{label}</label>
    <input type="file" className="w-full mt-1 px-3 py-2 rounded-xl border bg-transparent" />
  </div>
);

const Nav = ({ go, user, onLogout }) => {
  const [open, setOpen] = useState(false);
  const Link = ({ to, icon, label }) => (
    <button
      onClick={() => {
        setOpen(false);
        go(to);
      }}
      className="flex items-center gap-2 px-4 py-2 rounded-xl hover:bg-neutral-100/80 dark:hover:bg-neutral-800/60"
    >
      {icon}
      <span>{label}</span>
    </button>
  );
  return (
    <header className="sticky top-0 z-40 border-b border-neutral-200 dark:border-neutral-800 bg-white/80 dark:bg-neutral-900/70 backdrop-blur">
      <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
        <div className="flex items-center gap-3">
          <div className="h-9 w-9 rounded-xl bg-gradient-to-tr from-indigo-500 via-violet-500 to-fuchsia-500" />
          <div className="font-semibold tracking-tight">Digital Line Portal</div>
        </div>
        <nav className="hidden md:flex items-center gap-1 text-sm">
          <Link to="/" icon={<Home className="w-4 h-4" />} label="Home" />
          <Link to="/services" icon={<FileText className="w-4 h-4" />} label="Services" />
          <Link to="/distribution" icon={<Music2 className="w-4 h-4" />} label="Distribution" />
          <Link to="/market" icon={<ShoppingBag className="w-4 h-4" />} label="Marketplace" />
          <Link to="/artists" icon={<Users className="w-4 h-4" />} label="Artists" />
          {user?.role === "client" && (
            <Link to="/dashboard" icon={<Shield className="w-4 h-4" />} label="Client" />
          )}
          {user?.role === "admin" && (
            <Link to="/admin" icon={<Shield className="w-4 h-4" />} label="Admin" />
          )}
        </nav>
        <div className="hidden md:flex items-center gap-2">
          {!user ? (
            <button onClick={() => (window.location.hash = "/login")} className="px-3 py-2 text-sm rounded-xl border hover:bg-neutral-100 dark:hover:bg-neutral-800 flex items-center gap-2">
              <LogIn className="w-4 h-4" /> Login
            </button>
          ) : (
            <button onClick={onLogout} className="px-3 py-2 text-sm rounded-xl border hover:bg-neutral-100 dark:hover:bg-neutral-800 flex items-center gap-2">
              <LogOut className="w-4 h-4" /> Logout
            </button>
          )}
        </div>
        <button className="md:hidden" onClick={() => setOpen((v) => !v)}>
          {open ? <X /> : <Menu />}
        </button>
      </div>
      {open && (
        <div className="md:hidden px-4 pb-3 space-y-1">
          <button onClick={() => setOpen(false)} className="w-full hidden" />
          <div className="rounded-2xl border p-2">
            <div className="grid">
              <button onClick={() => (window.location.hash = "/")} className="px-3 py-2 text-left">Home</button>
              <button onClick={() => (window.location.hash = "/services")} className="px-3 py-2 text-left">Services</button>
              <button onClick={() => (window.location.hash = "/distribution")} className="px-3 py-2 text-left">Distribution</button>
              <button onClick={() => (window.location.hash = "/market")} className="px-3 py-2 text-left">Marketplace</button>
              <button onClick={() => (window.location.hash = "/artists")} className="px-3 py-2 text-left">Artists</button>
              {user?.role === "client" && (
                <button onClick={() => (window.location.hash = "/dashboard")} className="px-3 py-2 text-left">Client</button>
              )}
              {user?.role === "admin" && (
                <button onClick={() => (window.location.hash = "/admin")} className="px-3 py-2 text-left">Admin</button>
              )}
              <button onClick={() => (window.location.hash = "/login")} className="px-3 py-2 text-left">Login</button>
            </div>
          </div>
        </div>
      )}
    </header>
  );
};

// ------------------ Root App ------------------
export default function App() {
  const [route, setRoute] = useState(window.location.hash.replace("#", "") || "/");
  const [user, setUser] = useState(null);
  const [cart, setCart] = useState([]);
  const [booking, setBooking] = useState(null);

  const go = (to) => {
    window.location.hash = to;
    setRoute(to);
  };
  React.useEffect(() => {
    const onHash = () => setRoute(window.location.hash.replace("#", "") || "/");
    window.addEventListener("hashchange", onHash);
    return () => window.removeEventListener("hashchange", onHash);
  }, []);

  const addToCart = (item) => setCart((c) => [...c, item]);
  const removeFromCart = (id) => setCart((c) => c.filter((i) => i.id !== id));

  return (
    <div className="min-h-screen bg-white dark:bg-neutral-900 text-neutral-900 dark:text-neutral-100">
      <Nav go={go} user={user} onLogout={() => setUser(null)} />

      {route === "/" && <HomePage go={go} />}
      {route === "/services" && <ServicesPage go={go} />}
      {route === "/market" && <MarketplacePage onAdd={addToCart} />}
      {route === "/artists" && <ArtistsPage onBook={(a)=>setBooking(a)} />}
      {route === "/distribution" && <DistributionPage />}
      {route === "/dashboard" && <ClientDashboard />}
      {route === "/admin" && <AdminDashboard />}
      {route === "/login" && <LoginPage onLogin={(u)=>{ setUser(u); go(u.role==='admin'? '/admin' : '/dashboard')}} />}

      {/* Cart Drawer */}
      {!!cart.length && (
        <div className="fixed bottom-6 right-6 w-full max-w-sm rounded-2xl border bg-white/90 dark:bg-neutral-900/90 backdrop-blur shadow-xl">
          <div className="p-4 flex items-center justify-between">
            <div className="font-semibold">Cart ({cart.length})</div>
            <button onClick={()=>setCart([])} className="text-xs underline">Clear</button>
          </div>
          <div className="max-h-56 overflow-auto divide-y">
            {cart.map((it)=> (
              <div key={it.id} className="p-3 text-sm flex items-center justify-between">
                <span className="truncate" title={it.name}>{it.name}</span>
                <div className="flex items-center gap-2">
                  <span className="font-semibold">₹{it.price}</span>
                  <button onClick={()=>removeFromCart(it.id)} className="p-1 rounded-lg border"><Trash2 className="w-4 h-4"/></button>
                </div>
              </div>
            ))}
          </div>
          <div className="p-4 flex items-center justify-between">
            <div className="text-sm opacity-70">Total</div>
            <div className="font-bold">₹{cart.reduce((a,b)=>a+b.price,0)}</div>
          </div>
          <div className="px-4 pb-4">
            <button className="w-full px-4 py-2 rounded-xl bg-black text-white dark:bg-white dark:text-black">Checkout (Demo)</button>
          </div>
        </div>
      )}

      {/* Booking Modal */}
      {booking && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4">
          <div className="w-full max-w-md rounded-2xl border bg-white dark:bg-neutral-900 p-6 space-y-3">
            <div className="text-lg font-semibold">Book {booking.name}</div>
            <div className="text-sm opacity-80">Tags: {booking.tags.join(", ")} · Rating {booking.rating}</div>
            <div className="grid sm:grid-cols-2 gap-3 mt-2">
              <FormField label="Event Date" placeholder="DD/MM/YYYY" />
              <FormField label="City" placeholder="Your city" />
            </div>
            <div className="grid sm:grid-cols-2 gap-3">
              <FormField label="Contact Name" placeholder="Full name" />
              <FormField label="Phone" placeholder="98xxxxxx" />
            </div>
            <div className="flex justify-end gap-2 pt-2">
              <button onClick={()=>setBooking(null)} className="px-3 py-2 rounded-xl border">Cancel</button>
              <button onClick={()=>setBooking(null)} className="px-3 py-2 rounded-xl bg-black text-white dark:bg-white dark:text-black">Send Request</button>
            </div>
          </div>
        </div>
      )}

      <footer className="mt-16 border-t border-neutral-200 dark:border-neutral-800">
        <div className="max-w-7xl mx-auto px-4 py-8 text-sm opacity-70">© {new Date().getFullYear()} Digital Line — One Step Portal</div>
      </footer>
    </div>
  );
}
